<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thesis Tracker 3D - Interactive Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0f;
            color: #e2e8f0;
            overflow-x: hidden;
        }
        
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 0;
        }
        
        .ui-layer {
            position: relative;
            z-index: 10;
            pointer-events: none;
        }
        
        .ui-layer > * {
            pointer-events: auto;
        }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 16px;
        }
        
        .checkbox-custom {
            width: 22px;
            height: 22px;
            border: 2px solid #6366f1;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(99, 102, 241, 0.1);
        }
        
        .checkbox-custom.checked {
            background: #6366f1;
            border-color: #6366f1;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.6);
        }
        
        .checkbox-custom.checked::after {
            content: '‚úì';
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        
        .row-complete {
            background: rgba(16, 185, 129, 0.15) !important;
            border-left: 4px solid #10b981;
        }
        
        .row-active {
            background: rgba(245, 158, 11, 0.15) !important;
            border-left: 4px solid #f59e0b;
            animation: pulse-border 2s infinite;
        }
        
        @keyframes pulse-border {
            0%, 100% { box-shadow: inset 4px 0 0 #f59e0b; }
            50% { box-shadow: inset 4px 0 0 #fbbf24; }
        }
        
        .metric-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(168, 85, 247, 0.2));
            border: 1px solid rgba(99, 102, 241, 0.3);
            transition: all 0.3s;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.3);
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
        }
        
        .glow-text {
            text-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
        }
        
        .nav-tab {
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .nav-tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #6366f1, #a855f7);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .nav-tab.active::before {
            transform: scaleX(1);
        }
        
        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
            z-index: 100;
        }
        
        .save-indicator.saved {
            background: #10b981;
            color: white;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
        }
        
        .save-indicator.saving {
            background: #f59e0b;
            color: white;
        }
        
        .gantt-bar {
            height: 24px;
            border-radius: 6px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .gantt-bar:hover {
            filter: brightness(1.2);
            transform: scaleY(1.1);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.4); }
            50% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.6); }
        }
        
        .date-overdue {
            color: #ef4444;
            font-weight: 700;
        }
        
        .date-upcoming {
            color: #f59e0b;
            font-weight: 600;
        }
        
        .date-safe {
            color: #10b981;
        }
        
        .critical-badge {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 700;
        }
        
        .expand-btn {
            transition: transform 0.3s;
        }
        
        .expand-btn.expanded {
            transform: rotate(180deg);
        }
        
        .details-row {
            display: none;
        }
        
        .details-row.show {
            display: table-row;
        }
        
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        .view-section {
            display: none;
        }
        
        .view-section.active {
            display: block;
        }
        
        .heatmap-cell {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.2);
        }
    </style>
</head>
<body>

    <!-- 3D Background -->
    <div id="canvas-container"></div>

    <!-- Save Indicator -->
    <div id="save-indicator" class="save-indicator saved">Saved</div>

    <!-- UI Layer -->
    <div class="ui-layer min-h-screen p-4">
        
        <!-- Header -->
        <header class="glass-panel sticky-header mb-4 p-6 floating">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h1 class="text-3xl font-bold glow-text mb-2">Thesis Tracker 3D</h1>
                    <p class="text-sm text-slate-400">Investigating Student Retention of AI-Suggested Vocabulary</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="resetAll()" class="px-4 py-2 bg-red-500/20 text-red-400 rounded-lg text-sm hover:bg-red-500/30 transition border border-red-500/30">Reset</button>
                    <button onclick="exportData()" class="px-4 py-2 bg-emerald-500/20 text-emerald-400 rounded-lg text-sm hover:bg-emerald-500/30 transition border border-emerald-500/30">Export</button>
                    <button onclick="document.getElementById('import-file').click()" class="px-4 py-2 bg-blue-500/20 text-blue-400 rounded-lg text-sm hover:bg-blue-500/30 transition border border-blue-500/30">Import</button>
                    <input type="file" id="import-file" accept=".json" onchange="importData(this)" class="hidden">
                </div>
            </div>

            <!-- Metrics Dashboard -->
            <div class="grid grid-cols-6 gap-4 mb-4">
                <div class="metric-card p-4 rounded-xl">
                    <div class="text-xs text-slate-400 mb-1 uppercase tracking-wider">Overall</div>
                    <div class="text-3xl font-bold text-white" id="overall-progress">0%</div>
                    <div class="w-full bg-slate-700 rounded-full h-2 mt-2 overflow-hidden">
                        <div id="progress-bar" class="progress-bar h-full rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="metric-card p-4 rounded-xl">
                    <div class="text-xs text-slate-400 mb-1 uppercase tracking-wider">Completed</div>
                    <div class="text-3xl font-bold text-emerald-400" id="completed-count">0/35</div>
                    <div class="text-xs text-slate-500 mt-1">sections</div>
                </div>
                
                <div class="metric-card p-4 rounded-xl pulse-glow">
                    <div class="text-xs text-slate-400 mb-1 uppercase tracking-wider">Days Left</div>
                    <div class="text-3xl font-bold text-amber-400" id="days-left">40</div>
                    <div class="text-xs text-slate-500 mt-1">until Mar 30</div>
                </div>
                
                <div class="metric-card p-4 rounded-xl">
                    <div class="text-xs text-slate-400 mb-1 uppercase tracking-wider">Words</div>
                    <div class="text-3xl font-bold text-purple-400" id="words-written">0</div>
                    <div class="text-xs text-slate-500 mt-1">of 15,000</div>
                </div>
                
                <div class="metric-card p-4 rounded-xl" id="next-focus-card">
                    <div class="text-xs text-slate-400 mb-1 uppercase tracking-wider">Next Up</div>
                    <div class="text-sm font-bold text-indigo-300 leading-tight" id="next-section">Loading...</div>
                    <div class="text-xs text-slate-500 mt-1" id="next-date">-</div>
                </div>
                
                <div class="metric-card p-4 rounded-xl">
                    <div class="text-xs text-slate-400 mb-1 uppercase tracking-wider">Current</div>
                    <div class="text-2xl font-bold text-blue-400" id="current-chapter-display">Ch 1</div>
                    <div class="text-xs text-slate-500 mt-1" id="chapter-progress">0%</div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex gap-6 border-t border-slate-700 pt-4">
                <button class="nav-tab active px-4 py-2 text-sm font-medium" onclick="showView('dashboard')">üìä Dashboard</button>
                <button class="nav-tab px-4 py-2 text-sm font-medium" onclick="showView('tracker')">‚òëÔ∏è Tracker</button>
                <button class="nav-tab px-4 py-2 text-sm font-medium" onclick="showView('gantt')">üìÖ Gantt</button>
                <button class="nav-tab px-4 py-2 text-sm font-medium" onclick="showView('analytics')">üìà Analytics</button>
                <button class="nav-tab px-4 py-2 text-sm font-medium" onclick="showView('3dview')">üé≤ 3D View</button>
            </nav>
        </header>

        <!-- DASHBOARD VIEW -->
        <div id="dashboard-view" class="view-section active">
            
            <!-- 3D Chapter Rings -->
            <div class="glass-panel p-6 mb-4">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 bg-indigo-500 rounded-full animate-pulse"></span>
                    Chapter Progress Rings
                </h2>
                <div class="flex justify-around items-center" id="chapter-rings">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- Quick Stats Grid -->
            <div class="grid grid-cols-3 gap-4 mb-4">
                <div class="glass-panel p-4">
                    <h3 class="text-sm font-semibold text-slate-400 mb-3">Weekly Velocity</h3>
                    <div class="chart-container">
                        <canvas id="velocity-chart"></canvas>
                    </div>
                </div>
                
                <div class="glass-panel p-4">
                    <h3 class="text-sm font-semibold text-slate-400 mb-3">Chapter Distribution</h3>
                    <div class="chart-container">
                        <canvas id="distribution-chart"></canvas>
                    </div>
                </div>
                
                <div class="glass-panel p-4">
                    <h3 class="text-sm font-semibold text-slate-400 mb-3">Completion Forecast</h3>
                    <div class="chart-container">
                        <canvas id="forecast-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Heatmap -->
            <div class="glass-panel p-6">
                <h3 class="text-sm font-semibold text-slate-400 mb-3">Daily Activity Heatmap (Feb-Mar)</h3>
                <div id="heatmap-container" class="flex flex-wrap gap-1">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>

        <!-- TRACKER VIEW -->
        <div id="tracker-view" class="view-section">
            <div class="glass-panel overflow-hidden">
                <table class="w-full text-sm">
                    <thead class="bg-slate-800/80 text-left">
                        <tr>
                            <th class="p-3 w-10">‚úì</th>
                            <th class="p-3 w-24">Date</th>
                            <th class="p-3 w-12">Ch</th>
                            <th class="p-3">Section</th>
                            <th class="p-3 w-40">Key Concepts</th>
                            <th class="p-3 w-32">Paper</th>
                            <th class="p-3 w-24">Function</th>
                            <th class="p-3 w-8"></th>
                        </tr>
                    </thead>
                    <tbody id="tracker-body">
                        <!-- Generated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- GANTT VIEW -->
        <div id="gantt-view" class="view-section">
            <div class="glass-panel p-6">
                <h2 class="text-xl font-semibold mb-4">Project Timeline (Gantt)</h2>
                <div id="gantt-chart" class="space-y-2">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>

        <!-- ANALYTICS VIEW -->
        <div id="analytics-view" class="view-section">
            <div class="grid grid-cols-2 gap-4">
                <div class="glass-panel p-6">
                    <h3 class="text-lg font-semibold mb-4">Cumulative Progress</h3>
                    <div class="chart-container" style="height: 400px;">
                        <canvas id="cumulative-chart"></canvas>
                    </div>
                </div>
                
                <div class="glass-panel p-6">
                    <h3 class="text-lg font-semibold mb-4">Paper Usage Frequency</h3>
                    <div class="chart-container" style="height: 400px;">
                        <canvas id="papers-chart"></canvas>
                    </div>
                </div>
                
                <div class="glass-panel p-6">
                    <h3 class="text-lg font-semibold mb-4">Word Count by Chapter</h3>
                    <div class="chart-container" style="height: 400px;">
                        <canvas id="words-chart"></canvas>
                    </div>
                </div>
                
                <div class="glass-panel p-6">
                    <h3 class="text-lg font-semibold mb-4">Risk Assessment</h3>
                    <div id="risk-matrix" class="space-y-3">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 3D VIEW -->
        <div id="3dview-view" class="view-section">
            <div class="glass-panel p-6 text-center">
                <h2 class="text-2xl font-bold mb-4">Interactive 3D Visualization</h2>
                <p class="text-slate-400 mb-4">Move your mouse to rotate view. Hover over nodes for details.</p>
                <div class="grid grid-cols-3 gap-4 mt-6">
                    <div class="metric-card p-4 rounded-lg">
                        <div class="text-2xl font-bold text-indigo-400" id="nodes-active">7</div>
                        <div class="text-xs text-slate-400">Chapter Nodes</div>
                    </div>
                    <div class="metric-card p-4 rounded-lg">
                        <div class="text-2xl font-bold text-purple-400" id="particles-count">1000</div>
                        <div class="text-xs text-slate-400">Data Particles</div>
                    </div>
                    <div class="metric-card p-4 rounded-lg">
                        <div class="text-2xl font-bold text-emerald-400" id="completion-3d">0%</div>
                        <div class="text-xs text-slate-400">3D Progress</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ==========================================
        // THESIS DATA
        // ==========================================
        
        const thesisStructure = [
            { date: 'Feb 20', chapter: 1, chapterName: 'Introduction', section: '1.1 Background and Context', concepts: 'AI in L2 writing, performance vs learning', paper: 'Warschauer et al. (2023)', function: 'Anchor problem', words: 250 },
            { date: 'Feb 21', chapter: 1, chapterName: 'Introduction', section: '1.2 Statement of the Problem', concepts: 'Surface diversity, dependency', paper: 'Feng et al. (2025)', function: 'Justify gap', words: 250 },
            { date: 'Feb 22', chapter: 1, chapterName: 'Introduction', section: '1.3 Research Questions', concepts: 'Retention comparison, involvement prediction', paper: 'Laufer & Hulstijn (2001)', function: 'Frame inquiry', words: 250 },
            { date: 'Feb 22', chapter: 1, chapterName: 'Introduction', section: '1.4 Significance', concepts: 'Pedagogical frameworks', paper: 'Your synthesis', function: 'Claim contribution', words: 250 },
            { date: 'Feb 23', chapter: 1, chapterName: 'Introduction', section: '1.5 Scope and Delimitations', concepts: 'N=10, 2-week delay', paper: '-', function: 'Bound claims', words: 250 },
            { date: 'Feb 24', chapter: 1, chapterName: 'Introduction', section: '1.6 Organization', concepts: 'Chapter overview', paper: '-', function: 'Guide reader', words: 250 },
            
            { date: 'Feb 27', chapter: 2, chapterName: 'Literature Review', section: '2.1 AI Writing Tools in L2', concepts: 'Generative AI, AWE', paper: 'Hwang et al. (2025)', function: 'Method precedent', words: 650 },
            { date: 'Feb 28', chapter: 2, chapterName: 'Literature Review', section: '2.2 Vocabulary Theories', concepts: 'Incidental learning, depth vs breadth', paper: 'Laufer & Hulstijn; Wesche & Paribakht', function: 'Primary theory', words: 650 },
            { date: 'Mar 1', chapter: 2, chapterName: 'Literature Review', section: '2.3 Lexical Sophistication', concepts: 'Frequency, range, psycholinguistic', paper: 'Kim et al.; Kyle & Crossley', function: 'Operationalize', words: 650 },
            { date: 'Mar 2', chapter: 2, chapterName: 'Literature Review', section: '2.4 Performance vs Learning', concepts: 'Output quality, essay scores', paper: 'Jarvis (2013)', function: 'Warn overclaim', words: 650 },
            { date: 'Mar 3', chapter: 2, chapterName: 'Literature Review', section: '2.5 Dependency and Trust', concepts: 'Manufactured dependency', paper: 'Ranalli (2021); Ranalli et al.', function: 'Dependency lens', words: 650 },
            { date: 'Mar 4', chapter: 2, chapterName: 'Literature Review', section: '2.6 Research Gap', concepts: 'Longitudinal studies missing', paper: 'Feng et al. (2025)', function: 'Entry point', words: 650 },
            
            { date: 'Mar 5', chapter: 3, chapterName: 'Theoretical Framework', section: '3.1 Involvement Load Hypothesis', concepts: 'Need, search, evaluation', paper: 'Laufer & Hulstijn (2001)', function: 'Core framework', words: 400 },
            { date: 'Mar 6', chapter: 3, chapterName: 'Theoretical Framework', section: '3.2 Vocabulary Knowledge Scale', concepts: 'Receptive vs productive', paper: 'Wesche & Paribakht (1996)', function: 'Measurement tool', words: 400 },
            { date: 'Mar 7', chapter: 3, chapterName: 'Theoretical Framework', section: '3.3 Skill Acquisition Theory', concepts: 'Declarative ‚Üí procedural', paper: 'Anderson; DeKeyser', function: 'Background', words: 400 },
            { date: 'Mar 8', chapter: 3, chapterName: 'Theoretical Framework', section: '3.4 Noticing Hypothesis', concepts: 'Conscious attention', paper: 'Schmidt (1990)', function: 'Prerequisite', words: 400 },
            { date: 'Mar 9', chapter: 3, chapterName: 'Theoretical Framework', section: '3.5 Synthesis: Theoretical Model', concepts: 'Involvement ‚Üí depth ‚Üí retention', paper: 'Your synthesis', function: 'Unique contribution', words: 400 },
            
            { date: 'Mar 10', chapter: 4, chapterName: 'Methodology', section: '4.1 Research Design', concepts: 'Mixed-methods, within-subjects', paper: 'Hwang et al. (2025)', function: 'Justify design', words: 300 },
            { date: 'Mar 11', chapter: 4, chapterName: 'Methodology', section: '4.2 Participants', concepts: '10 students, sampling', paper: '-', function: 'Sampling strategy', words: 300 },
            { date: 'Mar 12', chapter: 4, chapterName: 'Methodology', section: '4.3 Instruments', concepts: 'VKS test, interview protocol', paper: 'Wesche & Paribakht', function: 'Validity', words: 300 },
            { date: 'Mar 13', chapter: 4, chapterName: 'Methodology', section: '4.4 Procedure', concepts: 'Session A, B, C overview', paper: 'Your design', function: 'Replicability', words: 300 },
            { date: 'Mar 13', chapter: 4, chapterName: 'DATA', section: 'Session A: No AI Writing', concepts: 'Baseline data collection', paper: '-', function: 'CRITICAL', words: 0, critical: true },
            { date: 'Mar 14', chapter: 4, chapterName: 'DATA', section: 'Session B: AI-Assisted', concepts: 'ChatGPT interaction', paper: '-', function: 'CRITICAL', words: 0, critical: true },
            { date: 'Mar 14', chapter: 4, chapterName: 'Methodology', section: '4.5 Data Collection Details', concepts: 'Physical monitoring', paper: '-', function: 'Execution', words: 300 },
            { date: 'Mar 15', chapter: 4, chapterName: 'Methodology', section: '4.6 Data Analysis', concepts: 'Paired comparison, thematic', paper: '-', function: 'Rigor', words: 300 },
            { date: 'Mar 16', chapter: 4, chapterName: 'Methodology', section: '4.7 Ethics', concepts: 'Consent, anonymity', paper: '-', function: 'Integrity', words: 300 },
            { date: 'Mar 17', chapter: 4, chapterName: 'Methodology', section: '4.8 Limitations', concepts: 'N=10, 2-week delay', paper: '-', function: 'Honest scholarship', words: 300 },
            
            { date: 'Mar 20', chapter: 5, chapterName: 'DATA', section: 'Session C: Delayed Test', concepts: 'Retention measurement', paper: '-', function: 'CRITICAL', words: 0, critical: true },
            { date: 'Mar 20', chapter: 5, chapterName: 'Findings', section: '5.1 Data Overview', concepts: 'Response rates, completion', paper: '-', function: 'Presentation', words: 500 },
            { date: 'Mar 21', chapter: 5, chapterName: 'Findings', section: '5.2 Retention Comparison', concepts: 'Session A vs B rates', paper: 'Your data', function: 'Answer RQ1', words: 500 },
            { date: 'Mar 22', chapter: 5, chapterName: 'Findings', section: '5.3 Involvement Correlations', concepts: 'Time, acceptance vs retention', paper: 'Laufer & Hulstijn', function: 'Answer RQ2', words: 500 },
            { date: 'Mar 23', chapter: 5, chapterName: 'Findings', section: '5.4 Acceptance Rationales', concepts: 'Why accept/reject', paper: 'Interview data', function: 'Insight', words: 500 },
            { date: 'Mar 24', chapter: 5, chapterName: 'Findings', section: '5.5 Case Profiles', concepts: 'Jahed, others', paper: 'Your data', function: 'Illustrate', words: 500 },
            { date: 'Mar 25', chapter: 5, chapterName: 'Findings', section: '5.6 Synthesis: Three Patterns', concepts: 'Scaffolding, prosthesis, hybrid', paper: 'Your synthesis', function: 'Classification', words: 500 },
            
            { date: 'Mar 26', chapter: 6, chapterName: 'Discussion', section: '6.1 Interpretation', concepts: 'Acquisition vs borrowing', paper: 'Warschauer et al.', function: 'Meaning-making', words: 500 },
            { date: 'Mar 27', chapter: 6, chapterName: 'Discussion', section: '6.2 Theoretical Implications', concepts: 'ILH confirmed', paper: 'Laufer & Hulstijn', function: 'Theory', words: 500 },
            { date: 'Mar 28', chapter: 6, chapterName: 'Discussion', section: '6.3 Pedagogical Implications', concepts: 'Maximize involvement', paper: 'Your synthesis', function: 'Application', words: 500 },
            { date: 'Mar 29', chapter: 6, chapterName: 'Discussion', section: '6.4 Methodological Contributions', concepts: 'Separate performance/learning', paper: 'Your design', function: 'Novelty', words: 500 },
            { date: 'Mar 29', chapter: 6, chapterName: 'Discussion', section: '6.5 Limitations & Future', concepts: 'N=10, short delay', paper: '-', function: 'Boundaries', words: 500 },
            
            { date: 'Mar 30', chapter: 7, chapterName: 'Conclusion', section: '7.1 Summary', concepts: 'Restate RQs, answers', paper: 'Your synthesis', function: 'Recapitulation', words: 400 },
            { date: 'Mar 30', chapter: 7, chapterName: 'Conclusion', section: '7.2 Final Remarks', concepts: 'Lexical prosthesis warning', paper: 'Your voice', function: 'Closing', words: 400 }
        ];

        // ==========================================
        // STATE MANAGEMENT
        // ==========================================
        
        let progressState = {};
        let charts = {};

        function loadState() {
            const saved = localStorage.getItem('thesisProgress3D');
            if (saved) {
                progressState = JSON.parse(saved);
            } else {
                thesisStructure.forEach((item, index) => {
                    progressState[index] = {
                        completed: false,
                        actualDate: item.date,
                        notes: ''
                    };
                });
            }
        }

        function saveState() {
            const indicator = document.getElementById('save-indicator');
            indicator.classList.remove('saved');
            indicator.classList.add('saving');
            indicator.textContent = 'Saving...';
            
            localStorage.setItem('thesisProgress3D', JSON.stringify(progressState));
            
            setTimeout(() => {
                indicator.classList.remove('saving');
                indicator.classList.add('saved');
                indicator.textContent = 'Saved';
            }, 400);
        }

        // ==========================================
        // THREE.JS 3D VISUALIZATION
        // ==========================================
        
        let scene, camera, renderer, particles, chapterNodes = [];
        
        function initThree() {
            const container = document.getElementById('canvas-container');
            
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 40;
            
            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);
            
            // Particle system
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const colors = [];
            
            for (let i = 0; i < 1500; i++) {
                vertices.push(
                    (Math.random() - 0.5) * 120,
                    (Math.random() - 0.5) * 120,
                    (Math.random() - 0.5) * 120
                );
                
                const color = new THREE.Color();
                color.setHSL(Math.random() * 0.3 + 0.5, 0.8, 0.5);
                colors.push(color.r, color.g, color.b);
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            
            const material = new THREE.PointsMaterial({
                size: 0.8,
                vertexColors: true,
                transparent: true,
                opacity: 0.6,
                blending: THREE.AdditiveBlending
            });
            
            particles = new THREE.Points(geometry, material);
            scene.add(particles);
            
            // Chapter nodes (7 chapters)
            for (let i = 1; i <= 7; i++) {
                const nodeGeometry = new THREE.IcosahedronGeometry(3, 1);
                const nodeMaterial = new THREE.MeshPhongMaterial({
                    color: 0x6366f1,
                    transparent: true,
                    opacity: 0.8,
                    wireframe: true,
                    emissive: 0x312e81,
                    emissiveIntensity: 0.5
                });
                
                const node = new THREE.Mesh(nodeGeometry, nodeMaterial);
                const angle = (i - 1) / 6 * Math.PI * 2;
                node.position.x = Math.cos(angle) * 25;
                node.position.y = Math.sin(angle) * 15;
                node.position.z = -20;
                node.userData = { chapter: i };
                
                // Inner solid core
                const coreGeometry = new THREE.SphereGeometry(1.5, 16, 16);
                const coreMaterial = new THREE.MeshBasicMaterial({
                    color: 0x6366f1,
                    transparent: true,
                    opacity: 0.9
                });
                const core = new THREE.Mesh(coreGeometry, coreMaterial);
                node.add(core);
                
                chapterNodes.push({ mesh: node, core: core, chapter: i });
                scene.add(node);
            }
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 2);
            scene.add(ambientLight);
            
            const pointLight = new THREE.PointLight(0x6366f1, 2, 100);
            pointLight.position.set(0, 0, 30);
            scene.add(pointLight);
            
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            
            particles.rotation.x += 0.0003;
            particles.rotation.y += 0.0005;
            
            chapterNodes.forEach((nodeObj, i) => {
                const node = nodeObj.mesh;
                node.rotation.x += 0.01;
                node.rotation.y += 0.008;
                
                // Float animation
                node.position.y += Math.sin(Date.now() * 0.001 + i) * 0.02;
                
                // Update color based on progress
                const progress = getChapterProgress(i + 1);
                const hue = progress === 100 ? 0.35 : (0.65 + progress * 0.002);
                nodeObj.core.material.color.setHSL(hue, 0.8, 0.5);
                node.material.emissive.setHSL(hue, 0.5, 0.3);
            });
            
            renderer.render(scene, camera);
        }

        function getChapterProgress(chapterNum) {
            const chapterItems = thesisStructure.filter((t, i) => t.chapter === chapterNum);
            const completed = chapterItems.filter((t, i) => {
                const globalIndex = thesisStructure.findIndex((th, ti) => th.chapter === chapterNum && chapterItems.indexOf(t) === i);
                return progressState[globalIndex]?.completed;
            }).length;
            return Math.round((completed / chapterItems.length) * 100);
        }

        function update3DProgress() {
            const total = thesisStructure.length;
            const completed = Object.values(progressState).filter(s => s.completed).length;
            document.getElementById('completion-3d').textContent = Math.round((completed / total) * 100) + '%';
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        document.addEventListener('mousemove', (e) => {
            const x = (e.clientX / window.innerWidth) * 2 - 1;
            const y = -(e.clientY / window.innerHeight) * 2 + 1;
            
            gsap.to(camera.position, {
                x: x * 8,
                y: y * 5,
                duration: 1,
                ease: 'power2.out'
            });
        });

        // ==========================================
        // UI RENDERING
        // ==========================================
        
        function showView(viewName) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            document.getElementById(viewName + '-view').classList.add('active');
            
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            if (viewName === 'tracker') renderTracker();
            if (viewName === 'gantt') renderGantt();
            if (viewName === 'analytics') renderAnalytics();
            if (viewName === '3dview') update3DProgress();
        }

        function renderChapterRings() {
            const container = document.getElementById('chapter-rings');
            container.innerHTML = '';
            
            for (let i = 1; i <= 7; i++) {
                const progress = getChapterProgress(i);
                const radius = 45;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (progress / 100) * circumference;
                
                const ringDiv = document.createElement('div');
                ringDiv.className = 'flex flex-col items-center cursor-pointer';
                ringDiv.onclick = () => highlightChapter(i);
                
                const color = progress === 100 ? '#10b981' : progress > 0 ? '#f59e0b' : '#6366f1';
                
                ringDiv.innerHTML = `
                    <div class="relative w-28 h-28">
                        <svg class="w-full h-full progress-ring" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="${radius}" fill="none" stroke="#1e293b" stroke-width="10"/>
                            <circle cx="50" cy="50" r="${radius}" fill="none" 
                                stroke="${color}" 
                                stroke-width="10" stroke-linecap="round"
                                stroke-dasharray="${circumference}" 
                                stroke-dashoffset="${offset}"
                                class="progress-ring-circle"/>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span class="text-2xl font-bold text-white">${i}</span>
                            <span class="text-xs text-slate-400">${progress}%</span>
                        </div>
                    </div>
                    <div class="mt-2 text-xs text-center text-slate-300 max-w-24">
                        ${getChapterName(i)}
                    </div>
                `;
                container.appendChild(ringDiv);
            }
        }

        function getChapterName(num) {
            const names = ['', 'Intro', 'Lit Review', 'Theory', 'Method', 'Findings', 'Discussion', 'Conclusion'];
            return names[num];
        }

        function highlightChapter(chapterNum) {
            // Scroll to chapter in tracker
            showView('tracker');
            const rows = document.querySelectorAll('#tracker-body tr');
            rows.forEach(row => {
                const chCell = row.querySelector('td:nth-child(3)');
                if (chCell && chCell.textContent === `Ch${chapterNum}`) {
                    row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    row.style.background = 'rgba(99, 102, 241, 0.3)';
                    setTimeout(() => row.style.background = '', 2000);
                }
            });
        }

        function renderTracker() {
            const tbody = document.getElementById('tracker-body');
            tbody.innerHTML = '';
            
            let currentChapter = 0;
            
            thesisStructure.forEach((item, index) => {
                if (item.chapter !== currentChapter) {
                    currentChapter = item.chapter;
                    const divider = document.createElement('tr');
                    divider.innerHTML = `<td colspan="8" class="h-2 bg-gradient-to-r from-transparent via-indigo-500 to-transparent"></td>`;
                    tbody.appendChild(divider);
                }
                
                const state = progressState[index];
                const isComplete = state.completed;
                const isActive = !isComplete && isNextIncomplete(index);
                
                let rowClass = '';
                if (isComplete) rowClass = 'row-complete';
                else if (isActive) rowClass = 'row-active';
                
                const dateStatus = getDateStatus(item.date, isComplete);
                
                const tr = document.createElement('tr');
                tr.className = `${rowClass} border-b border-slate-700/50 hover:bg-slate-800/40 transition-all`;
                
                tr.innerHTML = `
                    <td class="p-3">
                        <div class="checkbox-custom ${isComplete ? 'checked' : ''}" 
                             onclick="toggleComplete(${index})"></div>
                    </td>
                    <td class="p-3 ${dateStatus.class}">
                        <input type="date" value="${formatDateForInput(state.actualDate)}" 
                            onchange="updateDate(${index}, this.value)"
                            class="w-32 text-xs bg-slate-800 border border-slate-600 rounded px-2 py-1">
                    </td>
                    <td class="p-3 font-bold ${item.critical ? 'text-amber-400' : 'text-indigo-400'}">
                        Ch${item.chapter}
                    </td>
                    <td class="p-3">
                        <div class="font-medium text-white ${item.critical ? 'text-amber-300' : ''}">
                            ${item.section}
                            ${item.critical ? '<span class="critical-badge ml-2">CRITICAL</span>' : ''}
                        </div>
                    </td>
                    <td class="p-3 text-xs text-slate-400">${item.concepts}</td>
                    <td class="p-3 text-xs text-purple-400">${item.paper}</td>
                    <td class="p-3 text-xs text-emerald-400">${item.function}</td>
                    <td class="p-3">
                        <button class="expand-btn text-slate-400 hover:text-white" onclick="toggleDetails(${index})">‚ñº</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
                
                // Details row
                const detailsTr = document.createElement('tr');
                detailsTr.id = `details-${index}`;
                detailsTr.className = 'details-row bg-slate-900/60';
                detailsTr.innerHTML = `
                    <td colspan="8" class="p-4">
                        <div class="grid grid-cols-4 gap-4 text-xs">
                            <div>
                                <span class="text-slate-500">Target Words:</span>
                                <span class="text-white ml-2 font-bold">${item.words > 0 ? item.words.toLocaleString() : 'Data collection'}</span>
                            </div>
                            <div>
                                <span class="text-slate-500">Chapter:</span>
                                <span class="text-white ml-2">${item.chapterName}</span>
                            </div>
                            <div>
                                <span class="text-slate-500">Status:</span>
                                <span class="${isComplete ? 'text-emerald-400' : 'text-amber-400'} ml-2 font-bold">
                                    ${isComplete ? '‚úì Complete' : '‚óã Pending'}
                                </span>
                            </div>
                            <div>
                                <span class="text-slate-500">Progress:</span>
                                <span class="text-white ml-2">${getSectionProgress(index)}%</span>
                            </div>
                            <div class="col-span-4">
                                <span class="text-slate-500">Notes:</span>
                                <input type="text" value="${state.notes || ''}" 
                                    onchange="updateNotes(${index}, this.value)"
                                    placeholder="Add progress notes..."
                                    class="w-full mt-1 bg-slate-800 border border-slate-600 rounded px-3 py-2 text-white focus:border-indigo-500 outline-none">
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(detailsTr);
            });
        }

        function getDateStatus(dateStr, isComplete) {
            if (isComplete) return { class: 'date-safe' };
            const date = parseDate(dateStr);
            const today = new Date();
            const diff = Math.ceil((date - today) / (1000 * 60 * 60 * 24));
            
            if (diff < 0) return { class: 'date-overdue' };
            if (diff <= 3) return { class: 'date-upcoming' };
            return { class: 'date-safe' };
        }

        function isNextIncomplete(index) {
            for (let i = 0; i < thesisStructure.length; i++) {
                if (!progressState[i].completed) return i === index;
            }
            return false;
        }

        function getSectionProgress(index) {
            // Calculate progress based on sub-tasks if any
            return progressState[index].completed ? 100 : 0;
        }

        function toggleComplete(index) {
            progressState[index].completed = !progressState[index].completed;
            saveState();
            calculateMetrics();
            renderChapterRings();
            renderTracker();
            updateCharts();
        }

        function updateDate(index, value) {
            progressState[index].actualDate = formatDateFromInput(value);
            saveState();
            calculateMetrics();
        }

        function updateNotes(index, value) {
            progressState[index].notes = value;
            saveState();
        }

        function toggleDetails(index) {
            const row = document.getElementById(`details-${index}`);
            const btn = event.target;
            row.classList.toggle('show');
            btn.classList.toggle('expanded');
        }

        // ==========================================
        // METRICS & CALCULATIONS
        // ==========================================
        
        function calculateMetrics() {
            const total = thesisStructure.length;
            const completed = Object.values(progressState).filter(s => s.completed).length;
            const percentage = Math.round((completed / total) * 100);
            
            document.getElementById('overall-progress').textContent = percentage + '%';
            document.getElementById('progress-bar').style.width = percentage + '%';
            document.getElementById('completed-count').textContent = `${completed}/${total}`;
            
            // Days left
            const endDate = new Date('2025-03-30');
            const today = new Date();
            const daysLeft = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
            const daysEl = document.getElementById('days-left');
            daysEl.textContent = daysLeft > 0 ? daysLeft : 0;
            daysEl.className = daysLeft < 7 ? 'text-3xl font-bold text-red-400' : 'text-3xl font-bold text-amber-400';
            
            // Words written
            let wordsWritten = 0;
            thesisStructure.forEach((item, index) => {
                if (progressState[index]?.completed) {
                    wordsWritten += item.words;
                }
            });
            document.getElementById('words-written').textContent = wordsWritten.toLocaleString();
            
            // Next up
            const nextIndex = thesisStructure.findIndex((_, i) => !progressState[i].completed);
            if (nextIndex !== -1) {
                const next = thesisStructure[nextIndex];
                document.getElementById('next-section').textContent = next.section;
                document.getElementById('next-date').textContent = progressState[nextIndex].actualDate;
                document.getElementById('current-chapter-display').textContent = `Ch ${next.chapter}`;
                
                const chProgress = getChapterProgress(next.chapter);
                document.getElementById('chapter-progress').textContent = `${chProgress}% done`;
            } else {
                document.getElementById('next-section').textContent = '‚úì All Complete!';
                document.getElementById('next-date').textContent = 'Thesis Submitted';
                document.getElementById('current-chapter-display').textContent = 'Done';
                document.getElementById('next-focus-card').classList.add('pulse-glow');
            }
        }

        // ==========================================
        // GANTT CHART
        // ==========================================
        
        function renderGantt() {
            const container = document.getElementById('gantt-chart');
            container.innerHTML = '';
            
            const dateRange = getDateRange();
            
            thesisStructure.forEach((item, index) => {
                const state = progressState[index];
                const start = parseDate(state.actualDate);
                const duration = item.critical ? 1 : (item.words > 0 ? Math.max(1, Math.ceil(item.words / 500)) : 1);
                const end = new Date(start);
                end.setDate(end.getDate() + duration);
                
                const left = getPositionPercent(start, dateRange.start, dateRange.end);
                const width = getDurationPercent(duration, dateRange.start, dateRange.end);
                
                const isComplete = state.completed;
                const isCritical = item.critical;
                
                const bar = document.createElement('div');
                bar.className = 'flex items-center gap-3 mb-2';
                
                const colorClass = isComplete ? 'bg-emerald-500' : 
                                  isCritical ? 'bg-gradient-to-r from-amber-500 to-red-500' : 
                                  'bg-indigo-500';
                
                bar.innerHTML = `
                    <div class="w-48 text-xs text-slate-300 truncate">${item.section}</div>
                    <div class="flex-1 relative h-8 bg-slate-800 rounded-lg overflow-hidden">
                        <div class="gantt-bar ${colorClass} absolute h-full rounded-lg flex items-center px-2 text-xs text-white font-medium"
                             style="left: ${left}%; width: ${Math.max(width, 2)}%;"
                             title="${item.date}: ${item.concepts}">
                            ${width > 10 ? (isComplete ? '‚úì' : item.chapter) : ''}
                        </div>
                    </div>
                    <div class="w-16 text-xs ${isComplete ? 'text-emerald-400' : 'text-slate-500'}">
                        ${isComplete ? 'Done' : item.date}
                    </div>
                `;
                
                container.appendChild(bar);
            });
        }

        function getDateRange() {
            const dates = thesisStructure.map((t, i) => parseDate(progressState[i].actualDate));
            return {
                start: new Date(Math.min(...dates)),
                end: new Date('2025-03-30')
            };
        }

        function getPositionPercent(date, start, end) {
            const total = end - start;
            const pos = date - start;
            return (pos / total) * 100;
        }

        function getDurationPercent(days, start, end) {
            const total = end - start;
            return ((days * 24 * 60 * 60 * 1000) / total) * 100;
        }

        // ==========================================
        // ANALYTICS & CHARTS
        // ==========================================
        
        function renderAnalytics() {
            renderCumulativeChart();
            renderPapersChart();
            renderWordsChart();
            renderRiskMatrix();
        }

        function renderCumulativeChart() {
            const ctx = document.getElementById('cumulative-chart').getContext('2d');
            
            const data = [];
            let cumulative = 0;
            thesisStructure.forEach((item, index) => {
                if (progressState[index].completed) cumulative++;
                data.push(cumulative);
            });
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: thesisStructure.map((t, i) => `D${i+1}`),
                    datasets: [{
                        label: 'Sections Completed',
                        data: data,
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Target',
                        data: thesisStructure.map((_, i) => i + 1),
                        borderColor: '#10b981',
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#e2e8f0' } } },
                    scales: {
                        y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } },
                        x: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } }
                    }
                }
            });
        }

        function renderPapersChart() {
            const ctx = document.getElementById('papers-chart').getContext('2d');
            
            const paperCounts = {};
            thesisStructure.forEach((item, index) => {
                if (progressState[index].completed) {
                    const key = item.paper.split(' ')[0] + ' et al.';
                    paperCounts[key] = (paperCounts[key] || 0) + 1;
                }
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(paperCounts),
                    datasets: [{
                        label: 'Times Used',
                        data: Object.values(paperCounts),
                        backgroundColor: ['#6366f1', '#a855f7', '#10b981', '#f59e0b', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } },
                        x: { ticks: { color: '#94a3b8' }, grid: { display: false } }
                    }
                }
            });
        }

        function renderWordsChart() {
            const ctx = document.getElementById('words-chart').getContext('2d');
            
            const wordsByChapter = {};
            thesisStructure.forEach((item, index) => {
                if (progressState[index].completed) {
                    wordsByChapter[`Ch${item.chapter}`] = (wordsByChapter[`Ch${item.chapter}`] || 0) + item.words;
                }
            });
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(wordsByChapter),
                    datasets: [{
                        data: Object.values(wordsByChapter),
                        backgroundColor: ['#6366f1', '#a855f7', '#10b981', '#f59e0b', '#ef4444', '#3b82f6', '#8b5cf6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { position: 'right', labels: { color: '#e2e8f0' } }
                    }
                }
            });
        }

        function renderRiskMatrix() {
            const container = document.getElementById('risk-matrix');
            container.innerHTML = '';
            
            const risks = [
                { name: 'Time Overrun', level: 'Medium', desc: '39 days for 35 sections', color: 'text-amber-400', bg: 'bg-amber-500/10' },
                { name: 'Data Collection', level: 'High', desc: '3 critical sessions Mar 13-20', color: 'text-red-400', bg: 'bg-red-500/10' },
                { name: 'Sample Size', level: 'Low', desc: 'N=10 accepted for MA', color: 'text-emerald-400', bg: 'bg-emerald-500/10' },
                { name: 'Participant Dropout', level: 'Medium', desc: 'Have 2 backup students', color: 'text-amber-400', bg: 'bg-amber-500/10' }
            ];
            
            risks.forEach(risk => {
                const div = document.createElement('div');
                div.className = `flex justify-between items-center p-3 rounded-lg ${risk.bg} border border-slate-700`;
                div.innerHTML = `
                    <div>
                        <div class="font-medium text-white">${risk.name}</div>
                        <div class="text-xs text-slate-400">${risk.desc}</div>
                    </div>
                    <div class="text-sm font-bold ${risk.color}">${risk.level}</div>
                `;
                container.appendChild(div);
            });
        }

        function updateCharts() {
            // Re-render analytics if active
            if (document.getElementById('analytics-view').classList.contains('active')) {
                renderAnalytics();
            }
        }

        // ==========================================
        // DASHBOARD MINI-CHARTS
        // ==========================================
        
        function renderDashboardCharts() {
            // Velocity chart
            const vCtx = document.getElementById('velocity-chart').getContext('2d');
            new Chart(vCtx, {
                type: 'bar',
                data: {
                    labels: ['W1', 'W2', 'W3', 'W4', 'W5', 'W6'],
                    datasets: [{
                        label: 'Sections/Week',
                        data: [6, 6, 5, 9, 7, 2],
                        backgroundColor: '#6366f1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } },
                        x: { ticks: { color: '#94a3b8' } }
                    }
                }
            });
            
            // Distribution chart
            const dCtx = document.getElementById('distribution-chart').getContext('2d');
            new Chart(dCtx, {
                type: 'polarArea',
                data: {
                    labels: ['Ch1', 'Ch2', 'Ch3', 'Ch4', 'Ch5', 'Ch6', 'Ch7'],
                    datasets: [{
                        data: [6, 6, 5, 9, 7, 5, 2],
                        backgroundColor: [
                            'rgba(99, 102, 241, 0.7)',
                            'rgba(168, 85, 247, 0.7)',
                            'rgba(16, 185, 129, 0.7)',
                            'rgba(245, 158, 11, 0.7)',
                            'rgba(239, 68, 68, 0.7)',
                            'rgba(59, 130, 246, 0.7)',
                            'rgba(139, 92, 246, 0.7)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        r: { ticks: { color: '#94a3b8', backdropColor: 'transparent' }, grid: { color: '#334155' } }
                    }
                }
            });
            
            // Forecast chart
            const fCtx = document.getElementById('forecast-chart').getContext('2d');
            new Chart(fCtx, {
                type: 'line',
                data: {
                    labels: ['Now', 'W1', 'W2', 'W3', 'W4', 'W5', 'Deadline'],
                    datasets: [{
                        label: 'Projected',
                        data: [0, 20, 40, 60, 80, 95, 100],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Required',
                        data: [0, 15, 35, 55, 75, 90, 100],
                        borderColor: '#6366f1',
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#e2e8f0' } } },
                    scales: {
                        y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } },
                        x: { ticks: { color: '#94a3b8' } }
                    }
                }
            });
        }

        // ==========================================
        // HEATMAP
        // ==========================================
        
        function renderHeatmap() {
            const container = document.getElementById('heatmap-container');
            container.innerHTML = '';
            
            const start = new Date('2025-02-20');
            const end = new Date('2025-03-30');
            
            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDateFromInput(d.toISOString().split('T')[0]);
                const hasTask = thesisStructure.some((t, i) => progressState[i].actualDate === dateStr);
                const isComplete = thesisStructure.some((t, i) => 
                    progressState[i].actualDate === dateStr && progressState[i].completed
                );
                
                const cell = document.createElement('div');
                cell.className = 'heatmap-cell';
                cell.title = `${dateStr}: ${hasTask ? (isComplete ? 'Complete' : 'Pending') : 'No task'}`;
                
                if (isComplete) cell.style.background = '#10b981';
                else if (hasTask) cell.style.background = '#f59e0b';
                else cell.style.background = '#1e293b';
                
                container.appendChild(cell);
            }
        }

        // ==========================================
        // UTILITIES
        // ==========================================
        
        function parseDate(dateStr) {
            const months = { 'Feb': 1, 'Mar': 2, 'Apr': 3 };
            const parts = dateStr.split(' ');
            const month = months[parts[0]];
            const day = parseInt(parts[1]);
            return new Date(2025, month, day);
        }

        function formatDateForInput(dateStr) {
            try {
                const date = parseDate(dateStr);
                return date.toISOString().split('T')[0];
            } catch {
                return '2025-02-20';
            }
        }

        function formatDateFromInput(value) {
            const date = new Date(value);
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            return `${months[date.getMonth()]} ${date.getDate()}`;
        }

        function resetAll() {
            if (confirm('‚ö† Clear ALL progress? This cannot be undone.')) {
                localStorage.removeItem('thesisProgress3D');
                loadState();
                saveState();
                renderChapterRings();
                renderTracker();
                calculateMetrics();
                renderHeatmap();
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(progressState, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `thesis-progress-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    progressState = JSON.parse(e.target.result);
                    saveState();
                    renderChapterRings();
                    renderTracker();
                    calculateMetrics();
                    renderHeatmap();
                    alert('‚úì Progress imported successfully!');
                } catch (err) {
                    alert('‚úó Error importing file');
                }
            };
            reader.readAsText(file);
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================
        
        document.addEventListener('DOMContentLoaded', () => {
            initThree();
            loadState();
            renderChapterRings();
            calculateMetrics();
            renderDashboardCharts();
            renderHeatmap();
            
            // Animate entrance
            gsap.from('.glass-panel', {
                y: 50,
                opacity: 0,
                duration: 0.8,
                stagger: 0.1,
                ease: 'power3.out'
            });
        });
    </script>
</body>
</html>
